<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Elección de delegada/o</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div class="page">
    <header>
      <img src="Facultad Letras_Araba_bilingue_positivo_alta.jpg" alt="Facultad de Letras - Campus de Álava / Letren Fakultatea - Arabako Campusa" loading="lazy" />
      <h1>Irakasgaiaren kontsulta ordezkaria aukeratzeko / Consulta de asignatura para elección de delegada/o</h1>
      <p>Hautatu zure <strong>gradua</strong> eta matrikulatuta zauden <strong>ikasturterik</strong> altuena / Selecciona tu <strong>grado</strong> y el <strong>curso</strong> más alto en el que estés matriculado.</p>
    </header>

    <div class="form">
      <label for="gradoSel">Grado / Gradua:
        <select id="gradoSel"></select>
      </label>

      <label for="cursoSel">Curso / Ikasturtea:
        <select id="cursoSel"></select>
      </label>
    </div>

    <div id="results" hidden>
      <div class="table-wrapper"></div>
    </div>
  </div>

  <script>
    const CSV_FILE = 'LISTADOS_DELEGADOS_2025-2026.csv';
    const COL = {
      grado: 'GRADO / GRADUA',
      curso: 'IKASTURTEA / CURSO',
      grupo: 'GRUPO',
      lengua: 'HIZKUNTZA / LENGUA',
      asignatura: 'IRAKASGAIA / ASIGNATURA'
    };

    const gradoSel = document.getElementById('gradoSel');
    const cursoSel = document.getElementById('cursoSel');
    const results  = document.getElementById('results');
    let DATA = [];

    function loadCSV(){
      Papa.parse(CSV_FILE, {
        download: true,
        header: true,
        delimiter: ';',
        encoding: 'UTF-8',
        complete: (res) => {
          DATA = res.data.filter(r => r[COL.grado]);
          initFilters();
        }
      });
    }

    function uniqueSorted(arr){ return [...new Set(arr)].filter(Boolean).sort(); }

    function initFilters(){
      const grados = uniqueSorted(DATA.map(r => r[COL.grado]));
      gradoSel.innerHTML = '<option value="">— Aukeratu/Selecciona —</option>' + grados.map(g => `<option>${g}</option>`).join('');
      const cursos = uniqueSorted(DATA.map(r => r[COL.curso]));
      cursoSel.innerHTML = '<option value="">— Aukeratu/Selecciona —</option>' + cursos.map(c => `<option>${c}</option>`).join('');
      gradoSel.addEventListener('change', render);
      cursoSel.addEventListener('change', render);
    }

    function render(){
      const grado = gradoSel.value;
      const curso = cursoSel.value;
      if(!grado || !curso){
        results.hidden = true;
        results.innerHTML = '<div class="table-wrapper"></div>';
        return;
      }
      const rows = DATA.filter(r => r[COL.grado]===grado && r[COL.curso]===curso);
      if(rows.length===0){
        results.hidden = false;
        results.innerHTML='<p style="padding:1.2rem; margin:0;">Ez dago daturik / No hay coincidencias.</p>';
        return;
      }
      let html = '<div class="table-wrapper"><table><thead><tr><th>Taldea / Grupo</th><th>Hizkuntza / Lengua</th><th>Irakasgaia / Asignatura</th></tr></thead><tbody>';
      rows.forEach(r => {
        html += `<tr><td>${r[COL.grupo]}</td><td>${r[COL.lengua]}</td><td>${r[COL.asignatura]}</td></tr>`;
      });
      html += '</tbody></table></div>';
      results.hidden = false;
      results.innerHTML = html;
    }

    loadCSV();
  </script>
</body>
</html>
